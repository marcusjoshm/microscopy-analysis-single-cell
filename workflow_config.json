{
  "name": "Microscopy Single-Cell Analysis Workflow",
  "version": "1.0.0",
  "description": "Complete workflow for analyzing microscopy data with different conditions and timepoints",
  "imagej_path": "/Applications/Fiji.app/Contents/MacOS/ImageJ-macosx",
  "steps": [
    {
      "name": "setup_directories",
      "type": "function",
      "function": "setup_analysis_directories",
      "function_args": {},
      "description": "Create directory structure for analysis"
    },
    {
      "name": "select_timepoints",
      "type": "manual",
      "instructions": "Review available timepoints in the raw data and decide which timepoints to use for analysis. Current experiment has timepoints: {timepoints_list}. Press Enter when you have made your selection. You can specify timepoints when running the script with --timepoints option.",
      "description": "Select specific timepoints for analysis"
    },
    {
      "name": "select_regions",
      "type": "manual",
      "instructions": "Review available regions in the raw data and decide which regions to use for analysis. Current experiment has regions: {regions_list}. Press Enter when you have made your selection. You can specify regions when running the script with --regions option.",
      "description": "Select specific regions for analysis"
    },
    {
      "name": "bin_images_for_segmentation",
      "type": "python",
      "path": "scripts/bin_images.py",
      "args": ["--input", "{output_dir}/raw_data", "--output", "{output_dir}/preprocessed"],
      "description": "Bin images 4x4 for cell segmentation using Python"
    },
    {
      "name": "manual_quality_check",
      "type": "manual",
      "instructions": "Please review the preprocessed images in '{output_dir}/preprocessed' directory.\n\n1. Open each condition folder\n2. Look for artifacts or issues in the binned images\n3. Remove any images that show artifacts or are unsuitable for analysis\n\nWhen finished, press Enter to continue.",
      "description": "Manual quality check of preprocessed images"
    },
    {
      "name": "interactive_segmentation",
      "type": "bash",
      "path": "scripts/launch_segmentation_tools.sh",
      "args": ["{output_dir}/preprocessed"],
      "description": "Launch Cellpose and FIJI for interactive cell segmentation"
    },
    {
      "name": "roi_tracking",
      "type": "python",
      "path": "scripts/track_rois.py",
      "args": ["--input", "{output_dir}/preprocessed", "--recursive"],
      "description": "Track cells by matching ROIs between time points"
    },
    {
      "name": "resize_rois",
      "type": "python",
      "path": "scripts/resize_rois.py",
      "args": ["--input", "{output_dir}/preprocessed", "--output", "{output_dir}/ROIs", "--imagej", "{imagej_path}"],
      "description": "Resize ROIs from binned images to match original image dimensions"
    },
    {
      "name": "extract_cells",
      "type": "python",
      "path": "scripts/extract_cells.py",
      "args": ["--roi-dir", "{output_dir}/ROIs", "--raw-data-dir", "{output_dir}/raw_data", "--output-dir", "{output_dir}/cells", "--imagej", "{imagej_path}"],
      "description": "Extract individual cells using ROIs and save as separate files"
    },
    {
      "name": "group_cells",
      "type": "python",
      "path": "scripts/group_cells.py",
      "args": ["--cells-dir", "{output_dir}/cells", "--output-dir", "{output_dir}/grouped_cells", "--bins", "3"],
      "description": "Group cells by expression level and create summed images"
    },
    {
      "name": "threshold_grouped_cells",
      "type": "python",
      "path": "scripts/otsu_threshold_grouped_cells.py",
      "args": ["--input-dir", "{output_dir}/grouped_cells", "--output-dir", "{output_dir}/grouped_masks", "--imagej", "{imagej_path}"],
      "description": "Threshold grouped cell images to create masks"
    },
    {
      "name": "combine_masks",
      "type": "python",
      "path": "scripts/combine_masks.py",
      "args": ["--input-dir", "{output_dir}/grouped_masks", "--output-dir", "{output_dir}/combined_masks"],
      "description": "Combine mask images from different bin groups into single masks"
    },
    {
      "name": "create_cell_masks",
      "type": "python",
      "path": "scripts/create_cell_masks.py",
      "args": ["--roi-dir", "{output_dir}/ROIs", "--mask-dir", "{output_dir}/combined_masks", "--output-dir", "{output_dir}/masks", "--imagej", "{imagej_path}"],
      "description": "Create individual cell masks by applying ROIs to combined masks"
    },
    {
      "name": "feature_extraction",
      "type": "python",
      "path": "scripts/extract_features.py",
      "args": ["--input", "{output_dir}/raw_data", "--masks", "{output_dir}/masks", "--output", "{output_dir}/cells", "--regions", "{regions}", "--timepoints", "{timepoints}"],
      "description": "Extract features from segmented cells"
    },
    {
      "name": "merge_cell_data",
      "type": "python",
      "path": "scripts/merge_cell_data.py",
      "args": ["--input", "{output_dir}/cells", "--output", "{output_dir}/analysis/all_cells.csv"],
      "description": "Merge all cell data into a single dataset"
    },
    {
      "name": "statistical_analysis",
      "type": "python",
      "path": "scripts/analyze_data.py",
      "args": ["--input", "{output_dir}/analysis/all_cells.csv", "--output", "{output_dir}/analysis"],
      "description": "Perform statistical analysis on cell data"
    },
    {
      "name": "generate_visualizations",
      "type": "python",
      "path": "scripts/generate_plots.py",
      "args": ["--input", "{output_dir}/analysis/all_cells.csv", "--stats", "{output_dir}/analysis", "--output", "{output_dir}/analysis/figures"],
      "description": "Generate plots and visualizations"
    },
    {
      "name": "generate_report",
      "type": "python",
      "path": "scripts/generate_report.py",
      "args": ["--data", "{output_dir}/analysis/all_cells.csv", "--stats", "{output_dir}/analysis", "--figures", "{output_dir}/analysis/figures", "--output", "{output_dir}/analysis/final_report.html"],
      "description": "Generate final analysis report"
    }
  ]
}